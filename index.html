<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Swift Digital API Calendar Testing</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap-grid.css" integrity="sha256-ioAA5G7gdssuN24SL2ByxTMiyg5m5PnP3I4TS5hNIYA=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.css" integrity="sha256-A47OwxL/nAN0ydiDFTSGX7ftbfTJTKgiJ0zqCuTPDh4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://use.typekit.net/bbn4dro.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" integrity="sha256-/sdxenK1NDowSNuphgwjv8wSosSNZB0t5koXqd7XqOI=" crossorigin="anonymous" />
	
	<style type="text/css">
		
		body {font-family: open-sans, sans-serif; font-weight: 400; color: #454849; font-size: 14px; line-height: 22px;}
		h1 {font-family: proxima-nova, sans-serif; font-weight: 600; font-size: 30px; line-height:36px; margin-bottom: 20px; text-shadow: 3px 5px 14px rgba(0,0,0,.35);}
		.introBG p {color: #ffffff; font-size: 22px; line-height: 35px; font-family: proxima-nova, sans-serif;}
		.rowHeader {background-color: #4fc1e9; color: #ffffff;}
		.evRow {border: 1px solid #e6e6e6; border-top: 0px; background-color: #ffffff;}
		.altRow {background-color: #fafafa;}
		.evCol {border-right: 1px solid #e6e6e6; font-size: 14px; line-height: 22px;}
		.evRegister {border-right: 0px; font-weight: bold;}
		.evTitle, .evTitleH1 {font-weight: bold;}
		.evDate, .evDateH1 {max-width: 9%;}
		.evCapacity, .evCapacityH1 {max-width: 10%;}
		.evMoreInfo, .evMoreInfoH1 {max-width: 10%;}
		.evTime, .evTimeH1 {max-width: 14%;}
		.evColH1 {font-weight: bold; font-family: proxima-nova, sans-serif; font-weight: 600;}
		.evColH1, .evCol {padding: 12px;}
		.intro {padding-top: 25px; padding-bottom: 15px;}
		a {color: #009bde; border-bottom: 1px dotted; text-decoration: none;}
		a:hover {color: #1967b0; border-bottom: 1px solid; text-decoration: none;}
		.evMoreInfo_expand {background-color: #f2f2f2;border: 1px solid #e6e6e6; border-top: 0px; font-size: 14px; line-height: 22px;display: none;}
		.evMoreInfo_expand .col {padding: 12px;}
/*		.descTitle {max-width: 25%;  border: 5px solid #fff; border-right: 0px;}*/
		.descContent {border: 5px solid #fff;}
		.evFull {color: #989898;}
		.spotsRemaining {font-size: 11px; font-style: italic; font-weight: normal; color: #454849; line-height: 15px; padding-top: 5px;}
		.introBG {background-color: #4fc1e9; color: #ffffff; padding-top: 50px; padding-bottom: 50px;}
		.banner .racvLogo img {width: 100%; max-width: 100px;}
		.banner .racvLogo {padding: 25px 0px 25px 0px;}
		.footer .racvLogo img {width: 100%; max-width: 70px;}
		.monthRow {font-size: 24px; font-family: proxima-nova, sans-serif; font-weight: 700; line-height: 30px; color: #454849;}
		.monthRow .col {padding-left: 0px; padding-right: 0px; padding-bottom: 20px;}
		.monthContainer {margin-bottom: 25px;}
		.footer {margin-top: 40px; margin-bottom: 25px; font-size: 11px; line-height: 18px;}
		.footer .racvLogo {padding-left: 0px;}
		.footerText {padding-right: 0px;}
		.evFilters {padding-left: 0px; padding-right: 0px;}
		.evFilters select, .evFilters input {font-size: 14px; line-height: 22px;}
		.filterBG {background-color: #ec2176; padding-top: 40px; padding-bottom: 40px; border-bottom: 1px solid #e6e6e6; margin-bottom: 40px; color: #ffffff;}
		.no_record{display: none;text-align: center;}

      /* Extra small devices (portrait phones, less than 576px) */  
        @media (max-width: 575px) {.rowHeader {display: none !important;}.evRegister {padding-bottom: 12px !important;}.evTitle { color: #4fc1e9; font-weight: bold; font-size: 16px; line-height: 26px;}.evLocation:before {content: "Location: "; font-weight: bold;}.evDate:before {content: "Date: "; font-weight: bold;}.evTime:before {content: "Time: "; font-weight: bold;}.evCapacity:before {content: "Capacity: "; font-weight: bold;}.evMoreInfo {display: none !important;}.evCol {padding: 8px !important;border-right: 0px !important; padding-bottom: 0px !important;}.evRegister {padding-bottom: 8px !important;}.evRow {border: 1px solid #e6e6e6; margin-bottom: 10px; margin-left: 0px !important; margin-right: 0px !important; padding: 10px;}.evMoreInfo_expand {display: none !important;}.introBG{padding-top:0px; padding-bottom: 0px;}.introBG p {color: #ffffff; font-size: 16px; line-height: 26px; font-family: proxima-nova, sans-serif;} .filterBG {margin-bottom: 20px; padding-top: 20px; padding-bottom: 20px;} .monthRow .col {padding-left: 15px; padding-right: 15px; font-size: 20px; line-height: 26px;}.evFilters {padding-left: 15px; padding-right: 15px;}.locationFilter, .categoryFilter{margin-bottom: 20px;}.footer .row, .banner .row {padding-left: 15px; padding-right: 15px;}.evDate, .evDateH1, .evTime, .evTimeH1, .evCapacity, .evCapacityH1 {max-width: inherit;}}  

        /*  Small devices (landscape phones, 576px and up) */  
        @media (min-width: 576px) and (max-width: 767px) {.rowHeader {display: none !important;}.evTitle { color: #4fc1e9; font-weight: bold; font-size: 16px; line-height: 26px;}.evLocation:before {content: "Location: "; font-weight: bold;}.evDate:before {content: "Date: "; font-weight: bold;}.evTime:before {content: "Time: "; font-weight: bold;}.evCapacity:before {content: "Capacity: "; font-weight: bold;}.evMoreInfo {display: none !important;}.evCol {padding: 8px !important;border-right: 0px !important; padding-bottom: 0px !important;}.evRegister {padding-bottom: 8px !important;}.evRow {border: 1px solid #e6e6e6; margin-bottom: 10px; padding: 10px;}.intro {padding-left: 0px !important; padding-right: 0px !important;}.evMoreInfo_expand {display: none !important;}.monthRow .col {font-size: 24px; line-height: 28px;}.introBG{}.locationFilter, .categoryFilter{margin-bottom: 20px;}.evDate, .evDateH1, .evTime, .evTimeH1, .evCapacity, .evCapacityH1 {max-width: inherit;}}  

        /*  Medium devices (tablets, 768px and up) */  
        @media (min-width: 768px) and (max-width: 991px) {.evDescH1, .evDesc {display: none !important;}.intro {padding-left: 0px !important; padding-right: 0px !important;}.evRegister, .evRegisterH1 {min-width: 14%;}.evTime, .evTimeH1 {min-width: 21%;}.evColH1, .evCol {padding: 12px 5px 12px 5px;}.evDate, .evDateH1 {max-width: inherit;}}  

        /*  Large devices (desktops, 992px and up) */  
        @media (min-width: 992px) and (max-width: 1199px) {.evDescH1, .evDesc {display: none !important;}.intro {padding-left: 0px !important; padding-right: 0px !important;}.evTime, .evTimeH1 {min-width: 16%;}.evDate, .evDateH1 {max-width: inherit;}}  

        /*  Extra large devices (large desktops, 1200px and up) */  
        @media (min-width: 1200px) {.evDescH1, .evDesc {display: none !important;}.intro {padding-left: 0px !important; padding-right: 0px !important;}.evRegister, .evRegisterH1 {max-width: 12%;}.evTitle, .evTitleH1 {max-width: 25%;}.evLocation, .evLocationH1 {max-width: 20%;}}  
  
	</style>
</head>
<body>
	
	<div class="container banner">
	<div class="row"><div class="col racvLogo"><a href="https://www.swiftdigital.com.au/" target="_blank"><img src="https://www.swiftdigital.com.au/wp-content/uploads/2017/08/Swift-Digital-Logo-Circ.png" alt="Swift Digital" title="Swift Digital"></a></div></div>
	</div>
	
<div class="introBG">
  <div class="container">
    <div class="row">
      <div class="col intro">
        <h1>Swift Digital API Calendar Testing</h1>
        <p>This is a testing event calendar that uses API Calendar to verify any API issues.</p>
      </div>
    </div>
  </div>
</div>
	
<!-- Search filters start -->	
<div class="filterBG">	
	<div class="container evFilters">
    <div class="row">
      <div class="col-md locationFilter">
		  <label for="locationFilter"><i class="fas fa-map-marker-alt"></i> Filter by location</label>
		  
<select class="custom-select" id="locationFilter">
  <option value='' selected>Display all</option>

</select>

      </div>
		   <div class="col-md categoryFilter">
			   <label for="categoryFilter"><i class="fas fa-bookmark"></i> Filter by category </label>
			   
			   <select class="custom-select" id="categoryFilter">
          <option value='' selected>Display all</option>

</select>
      </div>
		   <div class="col-md searchFilter">
		<label for="searchFilter"><i class="fas fa-search"></i> Search by keyword</label>
			   <input type="text" class="form-control" id="searchFilter">
      </div>
    </div>
  </div></div>
<!-- Search filters end -->	
	
	
<div class="container">
	<div class="no_record"> Sorry, no matching events found. </div>
	<div class="container footer">
	<div class="row"><div class="col-4 racvLogo"><a href="https://www.swiftdigital.com.au/" target="_blank"><img src="https://www.swiftdigital.com.au/wp-content/uploads/2017/08/Swift-Digital-Logo-Circ.png" alt="Swift Digital" title="Swift Digital"></a></div>
		<div class="col-8 text-right footerText">
			&copy; 2019 Swift Digital. All Rights Reserved.
		</div></div>
	</div>
</div>
	
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.js" integrity="sha256-66f6uQTQkvHF8jpniLWJjnteEfmQaC/tATFew/nTBA8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/fontawesome.min.js" integrity="sha256-MoYcVrOTRHZb/bvF8DwaNkTJkqu9aCR21zOsGkkBo78=" crossorigin="anonymous"></script>
<script type="text/javascript">
   $(document).ready(function(){
      
   loadCalendar(true);
    function loadCalendar(filter) {
      $('.monthContainer').empty();
      var today = new Date(),oneYearFromNow = new Date();
      oneYearFromNow.setFullYear(oneYearFromNow.getFullYear() + 1);
 
      $.ajax({
         url: 'https://suite.swiftdigital.com.au/scripts/EventCalendar/calendar_v2.php',
         type: 'POST',
         dataType: 'jsonp',
         data:  {
                   t3account_id:'zzzz588183480f531928',
                   calendar_name:'Nino Tiglao Event Calendar',
                   filter:{
                            folder_id:15258,
                            ev_closure_date:{
                                           start:parseInt(today.getTime() / 1000),
                                           end: parseInt(oneYearFromNow.getTime() / 1000)
                                        } 
                            }
                },

         success:function(data) {
          var monthEvents = {};
          var locations = {};
          var categories  = {};
        
          $.each(data.data.events , function (i,el){

            if(el.notes !== undefined && el.notes.Location !== undefined && el.notes.Category !== undefined) {
                
                var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];         
                var d = new Date (el.schedule_stamp * 1000);
                if(!$.isArray(monthEvents[months[d.getMonth()]+' '+d.getFullYear()])){
                     monthEvents[months[d.getMonth()]+' '+d.getFullYear()] = [];
                }

                el.eventStartDate = d.toLocaleDateString("en-AU");
                monthEvents[months[d.getMonth()]+' '+d.getFullYear()].push(el);     
            }
          });

          var table = $('.footer');
          $.each(monthEvents, function (month, events){
 
            var monthHeading = $('<div>').addClass('row monthRow').append($('<div>').addClass('col').text(month));
            var heading = $('<div>').addClass('row rowHeader');
                heading.append($('<div>').addClass('col-md evTitleH1 evColH1').text('Event name'));
                heading.append($('<div>').addClass('col-md evLocationH1 evColH1').text('Location'));
                heading.append($('<div>').addClass('col-md evDateH1 evColH1').text('Date'));
                heading.append($('<div>').addClass('col-md evTimeH1 evColH1').text('Time'));
                heading.append($('<div>').addClass('col-md evCapacityH1 evColH1').text('Capacity'));
                heading.append($('<div>').addClass('col-md evMoreInfoH1 evColH1').text('More info'));
                heading.append($('<div>').addClass('col-md evDescH1 evColH1').text('Description'));
                heading.append($('<div>').addClass('col-md evRegisterH1 evColH1').text('Register'));
               
            var rows = $('<div>').addClass("monthContainer").append(monthHeading).append(heading);    

            $.each(events, function(i,event){
              
               $.each(event.notes.Location.split('|'),function(i,l){
                    l = l.trim();
                    locations[l] = l;
               }); 
               $.each(event.notes.Category.split('|'),function(i,c){
                    c = c.trim();
                    categories[c] = c;
               });   
               
                var dynamicClass = (parseInt(event.remaining_seats) <= 0 ?  'evFull' : (i%2==0 ? '' : 'altRow' ));
                var row = $('<div>').addClass('row evRow ' + dynamicClass).attr({
                                                                                    location: $('<div>').html(event.notes.Location).text(),
                                                                                    category: $('<div>').html(event.notes.Category).text(),
                                                                          });

                event.capacity = event.capacity == 'unlimited' || event.capacity == 0 ? 'Unlimited' : event.capacity;
                row.append($('<div>').addClass('col-md evTitle evCol').text(event.name));
                row.append($('<div>').addClass('col-md evLocation evCol').text(event.notes.Location));
                row.append($('<div>').addClass('col-md evDate evCol').text(event.eventStartDate));
                row.append($('<div>').addClass('col-md evTime evCol').text(event.prefs.START_TIME + ' - '+ event.prefs.FINISH_TIME));
                row.append($('<div>').addClass('col-md evCapacity evCol').append('<i class="far fa-check-circle"></i> ' + event.capacity ));

                row.append($('<div>').addClass('col-md evMoreInfo evCol').append($('<a>').attr('href','#').text('More info')));
                row.append($('<div>').addClass('col-md evDesc evCol').text(event.prefs.EV_DESC));
                var el = 
                row.append($('<div>').addClass('col-md evRegister evCol').append(

                    $('<a>').attr('href',event.link).attr('target','_blank').text((parseInt(event.remaining_seats) <= 0 ? 'Wait List ' : 'Register ' )).append($('<i>').addClass("fas fa-arrow-right"))).append('<br>').append($('<div>').addClass("spotsRemaining").text((parseInt(event.remaining_seats) <= 0 ? 'No spots remaining' : ( event.remaining_seats == 'unlimited' ? 'Unlimited spots' : event.remaining_seats + ' spots remaining' )))));

                rows.append(row).append($('<div>').addClass('row evMoreInfo_expand').append($('<div>').addClass("col descContent").html(event.prefs.EV_DESC)));
            });    

          table.before(rows);
           
          });

           if(filter) {
              var sortLocations = [], sortCategories = [];
              for (var location in locations) {
                  sortLocations.push([location]);
              } 
              for (var category in categories) {
                  sortCategories.push([category]);
              }

              sortLocations.sort();
              sortCategories.sort();
              
              $.each(sortLocations,function(i,location){
             
                 $('#locationFilter').append('<option value="' + location + '">' + location + '</option>');
              });
              $.each(sortCategories,function(i,category){
                 $('#categoryFilter').append('<option value="' + category + '">' + category + '</option>');
              });

           }

          $('.evMoreInfo > a').on("click", function (e) {
                  e.preventDefault();
                  $(this).parent().parent().next().toggle();
                   if($(this).parent().parent().next().is(':hidden')){
                      $(this).text('More info');
                   } else {
                      $(this).text('Collapse') ;
                   }
                  
              });
          $('#locationFilter,#categoryFilter').on('change', function(e) {
               
              e.preventDefault();
              $('.monthContainer').show();
              var serachFilter = $('#searchFilter').val(),
                locationFilter = $('#locationFilter').val(),
                categoryFilter = $('#categoryFilter').val();

              if(serachFilter !== "" || locationFilter !== '' || categoryFilter !== '') {
                $('.evRow').each(function() {
                  var field = $(this),
                      fieldText = field.text().toUpperCase().trim(),
                      locationText = field.attr('location').toUpperCase().trim(),
                      categoryText = field.attr('category').toUpperCase().trim();

                  if(fieldText.indexOf(serachFilter.toUpperCase()) >= 0 
                    && locationText.indexOf(locationFilter.toUpperCase()) >= 0
                    && categoryText.indexOf(categoryFilter.toUpperCase()) >= 0 ) {

                    if(field.is(':hidden')) {
                      field.show();
                    }
                  } else {
                    if(!field.is(':hidden')) {
                      field.hide();
                    }
                  }

                });
              } else {
                if($('.evRow:hidden').length > 0) {
                  $('.evRow:hidden').show();
                }
              }

              doUpdate();
            });   

             $('#searchFilter').on('input', function(e) {
               
              e.preventDefault();
              $('.monthContainer').show();
              var serachFilter = $('#searchFilter').val(),
                locationFilter = $('#locationFilter').val(),
                categoryFilter = $('#categoryFilter').val();

              if(serachFilter !== "" || locationFilter !== '' || categoryFilter !== '') {
                $('.evRow').each(function() {
                  var field = $(this),
                    fieldText = field.text().toUpperCase().trim(),
                    locationText = field.attr('location').toUpperCase().trim(),
                    categoryText = field.attr('category').toUpperCase().trim();

                  if(fieldText.indexOf(serachFilter.toUpperCase()) >= 0 
                    && locationText.indexOf(locationFilter.toUpperCase()) >= 0
                    && categoryText.indexOf(categoryFilter.toUpperCase()) >= 0 ) {

                    if(field.is(':hidden')) {
                      field.show();
                    }
                  } else {
                    if(!field.is(':hidden')) {
                      field.hide();
                    }
                  }

                });
              } else {
                if($('.evRow:hidden').length > 0) {
                  $('.evRow:hidden').show();
                }
              }

              doUpdate();
            });     

         } 

      });
      }
    
    function doUpdate(){
      $.each($('.monthContainer'),function(){
              
               if($(this).find('.evRow').length == $(this).find('.evRow:hidden').length){
                  $(this).hide();
               } else {
                $(this).show();
               }
            });
      if($('.evRow').length == $('.evRow:hidden').length) {
        $('.no_record').show();
      } else {
        $('.no_record').hide();
      }

    }

   });
</script>
</body>
</html>
